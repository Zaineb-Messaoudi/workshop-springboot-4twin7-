## Spring Boot Workshop

## HTTP Status Codes & Most Common Spring Exceptions

| HTTP Status                  | Main Spring Exception(s)                                                                 | Why it happens                                                                                           | Recommended Fix / Best Practice                                                                                                  |
|------------------------------|------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------|
| **400 Bad Request**          | `MethodArgumentNotValidException`<br>`HttpMessageNotReadableException`<br>`ConstraintViolationException`<br>`BindException` | Invalid/malformed payload, missing required fields, wrong types, JSON syntax error                       | • Always use `@Valid @RequestBody`<br>• Bean Validation annotations (`@NotNull`, `@Size`, `@Positive`, etc.)<br>• Global exception handler returning `FieldError` list |
| **401 Unauthorized**         | `AuthenticationException`<br>`BadCredentialsException`<br>`InvalidBearerTokenException` | No credentials, wrong password, expired/invalid JWT                                                             | • Check username/password<br>• Refresh token flow<br>• Custom `AuthenticationEntryPoint` that returns clean JSON |
| **403 Forbidden**            | `AccessDeniedException`                                                                  | User authenticated but lacks required role/authority                                                            | • `@PreAuthorize("hasRole('ADMIN')")` or `@Secured`<br>• Method-level security<br>• Custom `AccessDeniedHandler` |
| **404 Not Found**            | `NoHandlerFoundException`<br>`ResourceNotFoundException` (custom)<br>`EmptyResultDataAccessException` | Wrong URL or entity not found                                                                                   | • Throw custom `ResourceNotFoundException` in service<br>• Global handler → 404 with clear message |
| **405 Method Not Allowed**   | `HttpRequestMethodNotSupportedException`                                                 | Using POST on a GET-only endpoint, etc.                                                                          | • Correct `@GetMapping`, `@PostMapping`, …<br>• Allow needed methods explicitly |
| **406 Not Acceptable**       | `HttpMediaTypeNotAcceptableException`                                                    | Client `Accept` header asks for unsupported format (e.g. XML when only JSON is produced)                    | • Define `produces = {"application/json", "application/xml"}`<br>• Or negotiate properly |
| **409 Conflict**             | `DataIntegrityViolationException`<br>`DuplicateKeyException`<br>`OptimisticLockingFailureException` | Duplicate unique key, concurrent update conflict                                                                | • Check existence before insert<br>• Use `@Version` + retry logic<br>• Return meaningful message |
| **415 Unsupported Media Type**| `HttpMediaTypeNotSupportedException`                                                    | Wrong `Content-Type` (e.g. `text/plain` instead of `application/json`)                                          | • Always send `Content-Type: application/json`<br>• Declare `consumes = "application/json"` |
| **422 Unprocessable Entity** | Custom validation or `MethodArgumentNotValidException` (you map it to 422)               | Payload is valid JSON but fails business rules                                                                   | • Custom validators<br>• Return 422 instead of 400 when semantics are wrong |
| **426 Upgrade Required**     | Rarely used in APIs                                                                      | Client uses outdated API version                                                                                 | • Version your API (`/api/v1/`, `/api/v2/`)<br>• Return `Upgrade` header if needed |
| **429 Too Many Requests**    | `RateLimitExceededException` (custom with Bucket4j/Resilience4j)                         | Client exceeded rate limit                                                                                       | • Implement rate limiting (Bucket4j, Redis, etc.)<br>• Return `Retry-After` header |
| **500 Internal Server Error**| Any unhandled exception (`NullPointerException`, runtime bugs, etc.)                    | Bug or unexpected state on server side                                                                           | • NEVER expose stacktrace in prod<br>• Global `@ControllerAdvice`<br>• Log with correlation ID |
| **502 Bad Gateway**          | Proxy / API Gateway error                                                                | Upstream service returned invalid response                                                                       | • Check Nginx, Kong, Zuul, Spring Cloud Gateway config |
| **503 Service Unavailable**  | Overload, maintenance, DB down                                                           | Server temporarily unable to handle request                                                                      | • Health checks + circuit breaker<br>• Return `Retry-After` |
| **504 Gateway Timeout**      | Timeout calling another microservice                                                     | Downstream service too slow or unreachable                                                                       | • Set proper timeouts (WebClient, Feign, RestTemplate)<br>• Fallbacks + circuit breaker |

## Most Common Spring / JPA Exceptions & How to Handle Them

| Exception                                        | Typical Cause                                                   | Recommended Handling                                                                                            |
|--------------------------------------------------|-----------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------|
| `MethodArgumentNotValidException`                | `@Valid` failed on `@RequestBody`                               | `@ExceptionHandler` → extract `fieldErrors` → return 400 with details                                           |
| `ConstraintViolationException`                   | Validation on `@PathVariable` / `@RequestParam`                 | Same global handler or specific one for 400                                                                     |
| `HttpMessageNotReadableException`                | Malformed JSON, missing body, wrong date format                 | Clear message: "Malformed JSON", "Required request body is missing"                                            |
| `DataIntegrityViolationException`                | Unique constraint, FK violation                                 | Translate to 409 Conflict with user-friendly message                                                           |
| `DuplicateKeyException` (PostgreSQL/MySQL)       | Insert duplicate primary/unique key                             | Same as above – 409                                                                                             |
| `OptimisticLockingFailureException`              | `@Version` conflict                                             | Return 409 + "Resource was modified by another user – please reload"                                           |
| `EntityNotFoundException` / `EmptyResultDataAccessException` | `repository.getReferenceById(id)` or `findById` on missing entity | Throw custom `ResourceNotFoundException` → 404                                                                  |
| `JpaSystemException` / `TransactionSystemException` | Transaction rollback issues (validation inside @Transactional) | Usually caused by validation exception – catch and rethrow as business exception                               |
| `AccessDeniedException`                          | Spring Security denies access                                   | Custom `AccessDeniedHandler` returning JSON 403 instead of redirect                                            |
| `MethodNotAllowedException`                      | Wrong HTTP verb                                                 | Already handled by Spring (405)                                                                                 |
| `MissingServletRequestParameterException`        | Required `@RequestParam` missing                                | Global handler → 400                                                                                            |
| `TypeMismatchException` / `ConversionFailedException` | Sending "abc" where Integer expected                     | 400 with clear message                                                                                          |
| `AsyncRequestTimeoutException`                   | `@Async` method timeout                                         | Configure async timeout or handle gracefully                                                                    |
| `MaxUploadSizeExceededException`                 | File too big (multipart)                                        | Global handler → 413 Payload Too Large + clear message                                                         |
| `AuthenticationServiceException`                 | Problem inside your AuthenticationProvider                      | Usually 500 – log and investigate                                                                              |
| `LockedException`                                | Account locked (too many failed logins)                         | Return 423 Locked or 401 with specific message                                                                  |
